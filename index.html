<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>ãŠãˆã‹ãã®æ£® ãŠé¡Œãƒ•ã‚£ãƒ«ã‚¿ãƒ¼</title>
  <style>
    body {
      font-family: "Segoe UI", sans-serif;
      background: #fdfdfd;
      color: #333;
      padding: 2em;
      max-width: 1000px;
      margin: auto;
    }

    h1 {
      font-size: 2em;
      margin-bottom: 1em;
      text-align: center;
      color: #444;
    }

    .filters {
      display: flex;
      flex-wrap: wrap;
      gap: 1em;
      justify-content: center;
      margin-bottom: 1.5em;
    }

    .filters label {
      display: flex;
      align-items: center;
      gap: 0.5em;
      font-size: 0.95em;
    }

    input[type="text"],
    input[type="number"],
    select {
      padding: 5px 10px;
      border-radius: 6px;
      border: 1px solid #ccc;
    }

    input[type="checkbox"] {
      transform: scale(1.2);
    }

    table {
      border-collapse: collapse;
      width: 100%;
      background: white;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 0 8px rgba(0,0,0,0.05);
    }

    th, td {
      border: 1px solid #eee;
      padding: 10px 12px;
      text-align: left;
    }

    th {
      background-color: #f3f3f3;
    }

    tr:nth-child(even) {
      background-color: #f9f9f9;
    }

    tr:hover {
      background-color: #f0f8ff;
    }

    a {
      color: #007acc;
      text-decoration: none;
      font-weight: bold;
    }

    a:hover {
      text-decoration: underline;
    }

    .badge {
      background: #e0e0e0;
      border-radius: 999px;
      padding: 2px 10px;
      font-size: 0.85em;
      display: inline-block;
      color: #555;
    }

    /* é›£æ˜“åº¦è‰² */
    .level-ã‚„ã•ã—ã„ { background-color: #ffd6e8; }
    .level-ã‚„ã•ã—ã„å”åŠ› { background-color: #ffadd0; }
    .level-ãµã¤ã† { background-color: #ccf2cc; }
    .level-ãµã¤ã†å”åŠ› { background-color: #99e699; }
    .level-ã‚€ãšã‹ã—ã„ { background-color: #cce0ff; }
    .level-ã‚€ãšã‹ã—ã„å”åŠ› { background-color: #99bbff; }

    @media (max-width: 600px) {
      body {
        padding: 1em;
      }
      .filters {
        flex-direction: column;
        align-items: flex-start;
      }
    }
  </style>
</head>
<body>
  <h1>ãŠãˆã‹ãã®æ£® ãŠé¡Œãƒ•ã‚£ãƒ«ã‚¿ãƒ¼</h1>

  <div class="filters">
    <label>é›£æ˜“åº¦:
      <select id="levelFilter">
        <option value="">ã™ã¹ã¦</option>
        <option value="ã‚„ã•ã—ã„">ã‚„ã•ã—ã„</option>
        <option value="ã‚„ã•ã—ã„å”åŠ›">ã‚„ã•ã—ã„å”åŠ›</option>
        <option value="ãµã¤ã†">ãµã¤ã†</option>
        <option value="ãµã¤ã†å”åŠ›">ãµã¤ã†å”åŠ›</option>
        <option value="ã‚€ãšã‹ã—ã„">ã‚€ãšã‹ã—ã„</option>
        <option value="ã‚€ãšã‹ã—ã„å”åŠ›">ã‚€ãšã‹ã—ã„å”åŠ›</option>
      </select>
    </label>

    <label><input type="checkbox" id="normalMode" checked />é€šå¸¸ãƒ¢ãƒ¼ãƒ‰</label>
    <label><input type="checkbox" id="coopMode" checked />å”åŠ›ãƒ¢ãƒ¼ãƒ‰</label>

    <label>æ–‡å­—æ•°:
      <input type="number" id="lengthFilter" min="1" placeholder="ä¾‹: 3" />
    </label>

    <label>é ­æ–‡å­—:
      <input type="text" id="firstCharFilter" maxlength="1" placeholder="ä¾‹: ã‚" />
    </label>

    <label>æ¤œç´¢:
      <input type="text" id="keywordFilter" placeholder="ãŠé¡Œã‚„èª­ã¿ã‚’å…¥åŠ›" />
    </label>
  </div>

  <table id="wordTable" style="display:none;">
    <thead>
      <tr>
        <th>é›£æ˜“åº¦</th><th>ãŠé¡Œ</th><th>ã²ã‚‰ãŒãª</th><th>åˆ¥è§£</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    let allData = [];

    function toClassName(str) {
      return str.replace(/[\sã€€]/g, '');
    }

    function fetchCSV(url = 'oekaki_words.csv') {
      return fetch(url)
        .then(res => res.text())
        .then(text => {
          const lines = text.trim().split('\n');
          const headers = lines[0].split(',');
          return lines.slice(1).map(line => {
            const values = line.split(',');
            let obj = {};
            headers.forEach((h, i) => obj[h] = values[i]?.trim() || '');
            return obj;
          });
        });
    }

    function renderTable(filtered) {
      const tbody = document.querySelector('#wordTable tbody');
      tbody.innerHTML = '';
      filtered.forEach(row => {
        const altCount = Object.keys(row)
          .filter(k => k.startsWith('åˆ¥è§£'))
          .map(k => row[k])
          .filter(Boolean).length;

        const levelClass = 'level-' + toClassName(row['é›£æ˜“åº¦']);
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td class="${levelClass}">${row['é›£æ˜“åº¦']}</td>
          <td><a href="detail.html?word=${encodeURIComponent(row['ãŠé¡Œ'])}">${row['ãŠé¡Œ']}</a></td>
          <td>${row['ã²ã‚‰ãŒãª']}</td>
          <td><span class="badge">${altCount}ä»¶</span></td>`;
        tbody.appendChild(tr);
      });

      document.getElementById('wordTable').style.display = filtered.length ? 'table' : 'none';
    }

    function applyFilters() {
      const level = document.getElementById('levelFilter').value;
      const length = parseInt(document.getElementById('lengthFilter').value);
      const firstChar = document.getElementById('firstCharFilter').value;
      const keyword = document.getElementById('keywordFilter').value.toLowerCase();
      const normalMode = document.getElementById('normalMode').checked;
      const coopMode = document.getElementById('coopMode').checked;

      const filtered = allData.filter(row => {
        if (level && row['é›£æ˜“åº¦'] !== level) return false;
        if (!isNaN(length) && row['ã²ã‚‰ãŒãª'].length !== length) return false;
        if (firstChar && !row['ã²ã‚‰ãŒãª'].startsWith(firstChar)) return false;
        if (keyword && !(
          row['ãŠé¡Œ'].toLowerCase().includes(keyword) ||
          row['ã²ã‚‰ãŒãª'].toLowerCase().includes(keyword)
        )) return false;

        const isCoop = row['é›£æ˜“åº¦'].includes('å”åŠ›');
        if ((!coopMode && isCoop) || (!normalMode && !isCoop)) return false;

        return true;
      });

      renderTable(filtered);
    }

    ['levelFilter', 'lengthFilter', 'firstCharFilter', 'keywordFilter', 'normalMode', 'coopMode'].forEach(id => {
      document.getElementById(id).addEventListener('input', applyFilters);
    });

    fetchCSV()
      .then(data => {
        allData = data;
        renderTable(data);
      })
      .catch(err => {
        alert('CSVã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸğŸ¥²');
        console.error(err);
      });
  </script>
</body>
</html>
