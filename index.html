<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>ãŠãˆã‹ãã®æ£® ãŠé¡Œãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ï¼ˆãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ï¼‰</title>
  <style>
    body { font-family: sans-serif; padding: 1em; background: #f9f9f9; }
    table { border-collapse: collapse; width: 100%; margin-top: 1em; }
    th, td { border: 1px solid #ccc; padding: 6px 10px; text-align: left; }
    th { background: #eee; }
    a { color: #0077cc; text-decoration: none; }
    a:hover { text-decoration: underline; }
    label { margin-right: 10px; }
    select, input { margin-right: 1em; }

    /* é›£æ˜“åº¦è‰² */
    .level-ã‚„ã•ã—ã„ { background-color: #ffd6e8; }
    .level-ã‚„ã•ã—ã„å”åŠ› { background-color: #ffadd0; }
    .level-ãµã¤ã† { background-color: #ccf2cc; }
    .level-ãµã¤ã†å”åŠ› { background-color: #99e699; }
    .level-ã‚€ãšã‹ã—ã„ { background-color: #cce0ff; }
    .level-ã‚€ãšã‹ã—ã„å”åŠ› { background-color: #99bbff; }

    /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ */
    @media (max-width: 600px) {
      table {
        display: block;
        overflow-x: auto;
        white-space: nowrap;
      }
      body {
        padding: 0.5em;
        font-size: 14px;
      }
    }
  </style>
</head>
<body>
  <h1>ãŠãˆã‹ãã®æ£® ãŠé¡Œãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ï¼ˆãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ï¼‰</h1>

  <div>
    <label>é›£æ˜“åº¦:
      <select id="levelFilter">
        <option value="">ã™ã¹ã¦</option>
        <option value="ã‚„ã•ã—ã„">ã‚„ã•ã—ã„</option>
        <option value="ã‚„ã•ã—ã„å”åŠ›">ã‚„ã•ã—ã„å”åŠ›</option>
        <option value="ãµã¤ã†">ãµã¤ã†</option>
        <option value="ãµã¤ã†å”åŠ›">ãµã¤ã†å”åŠ›</option>
        <option value="ã‚€ãšã‹ã—ã„">ã‚€ãšã‹ã—ã„</option>
        <option value="ã‚€ãšã‹ã—ã„å”åŠ›">ã‚€ãšã‹ã—ã„å”åŠ›</option>
      </select>
    </label>

    <label>æ–‡å­—æ•°:
      <input type="number" id="lengthFilter" min="1" placeholder="ä¾‹: 3" />
    </label>

    <label>é ­æ–‡å­—:
      <input type="text" id="firstCharFilter" maxlength="1" placeholder="ä¾‹: ã‚" />
    </label>
  </div>

  <table id="wordTable" style="display:none;">
    <thead>
      <tr>
        <th>é›£æ˜“åº¦</th><th>ãŠé¡Œ</th><th>ã²ã‚‰ãŒãª</th><th>åˆ¥è§£</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    let allData = [];

    // æ—¥æœ¬èªã«å¯¾å¿œã—ãŸã‚¯ãƒ©ã‚¹åå¤‰æ›
    function toClassName(str) {
      return str.replace(/[\sã€€]/g, '');  // ç©ºç™½ã ã‘é™¤å»
    }

    function fetchCSV(url) {
      return fetch(url)
        .then(res => res.text())
        .then(text => {
          const lines = text.trim().split('\n');
          const headers = lines[0].split(',');
          return lines.slice(1).map(line => {
            const values = line.split(',');
            let obj = {};
            headers.forEach((h, i) => obj[h] = values[i]?.trim() || '');
            return obj;
          });
        });
    }

    function renderTable(filtered) {
      const tbody = document.querySelector('#wordTable tbody');
      tbody.innerHTML = '';
      filtered.forEach(row => {
        const altAnswersCount = Object.keys(row)
          .filter(key => key.startsWith('åˆ¥è§£'))
          .map(key => row[key])
          .filter(Boolean).length;

        const levelClass = 'level-' + toClassName(row['é›£æ˜“åº¦']);
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td class="${levelClass}">${row['é›£æ˜“åº¦']}</td>
          <td><a href="detail.html?word=${encodeURIComponent(row['ãŠé¡Œ'])}">${row['ãŠé¡Œ']}</a></td>
          <td>${row['ã²ã‚‰ãŒãª']}</td>
          <td>${altAnswersCount}ä»¶</td>`;
        tbody.appendChild(tr);
      });
      document.getElementById('wordTable').style.display = filtered.length ? 'table' : 'none';
    }

    function applyFilters() {
      const level = document.getElementById('levelFilter').value;
      const length = parseInt(document.getElementById('lengthFilter').value);
      const firstChar = document.getElementById('firstCharFilter').value;

      const filtered = allData.filter(row => {
        if (level && row['é›£æ˜“åº¦'] !== level) return false;
        if (!isNaN(length) && row['ã²ã‚‰ãŒãª'].length !== length) return false;
        if (firstChar && !row['ã²ã‚‰ãŒãª'].startsWith(firstChar)) return false;
        return true;
      });

      renderTable(filtered);
    }

    // ã‚¤ãƒ™ãƒ³ãƒˆç™»éŒ²ï¼ˆãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åæ˜ ï¼‰
    ['levelFilter', 'lengthFilter', 'firstCharFilter'].forEach(id => {
      document.getElementById(id).addEventListener('input', applyFilters);
    });

    fetchCSV('oekaki_words.csv')
      .then(data => {
        allData = data;
        renderTable(data);
      })
      .catch(err => {
        alert('CSVã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸğŸ¥²');
        console.error(err);
      });
  </script>
</body>
</html>
